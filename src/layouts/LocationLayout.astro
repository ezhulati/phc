---
/**
 * Location Layout - Clean Design
 * Matches WordPress style with simple hero and clear sections
 */

import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '@/components/common/Breadcrumbs.astro';
import Button from '@/components/ui/Button.astro';
import FAQAccordion from '@/components/locations/FAQAccordion';
import InsuranceLogos from '@/components/home/InsuranceLogos.astro';
import { getLangFromUrl, t } from '@/i18n/ui';
import { generateLocalBusinessSchema, generateFAQSchema } from '@/lib/utils/schema';
import type { WPLocation } from '@/lib/graphql/types';

interface Props {
  location: WPLocation;
  nearbyLocations?: WPLocation[];
}

const { location, nearbyLocations = [] } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const homeLabel = t(lang, 'nav.home');
const homeHref = lang === 'es' ? '/es/' : '/';
const abaLabel = t(lang, 'nav.abaTherapy');
const abaHref = lang === 'es' ? '/es/terapia-aba/' : '/aba-therapy/';
const texasLabel = 'Texas';
const texasHref = lang === 'es' ? '/es/terapia-aba/texas/' : '/aba-therapy/texas/';

// Extract city name
const cityName = location.locationFields?.cityName ||
  location.title.replace(/ABA Therapy in |Terapia ABA en /gi, '') ||
  location.slug.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');

const title = location.seo?.title || (lang === 'es'
  ? `Terapia ABA a Domicilio en ${cityName}, Texas | Prospera Healthcare`
  : `In-Home ABA Therapy in ${cityName}, Texas | Prospera Healthcare`);

const description = location.seo?.metaDesc || (lang === 'es'
  ? `Servicios profesionales de terapia ABA para niños con autismo en ${cityName}, Texas. Tratamiento personalizado a domicilio. Contacte a Prospera Healthcare hoy.`
  : `Professional ABA therapy services for children with autism in ${cityName}, Texas. Personalized in-home treatment. Contact Prospera Healthcare today.`);

const canonicalUrl = lang === 'es'
  ? `https://prosperahealthcare.com/es/terapia-aba/texas/${location.slug}/`
  : `https://prosperahealthcare.com/aba-therapy/texas/${location.slug}/`;

const ogImage = location.seo?.opengraphImage?.sourceUrl ||
  location.featuredImage?.node?.sourceUrl ||
  '/images/wp/ABA-Therapy-Texas.jpeg';

const breadcrumbs = [
  { name: homeLabel, href: homeHref },
  { name: abaLabel, href: abaHref },
  { name: texasLabel, href: texasHref },
  { name: cityName, href: canonicalUrl },
];

// Services
const defaultServices = lang === 'es' ? [
  {
    title: 'Terapia ABA 1:1 a Domicilio',
    description: 'Sesiones personalizadas uno a uno que mejoran la comunicación, habilidades sociales y destrezas de la vida diaria.',
    image: '/images/wp/AdobeStock_569313061.jpeg'
  },
  {
    title: 'Intervención Conductual Temprana',
    description: 'Terapia intensiva para niños pequeños que construye bases de desarrollo cruciales.',
    image: '/images/wp/Behavior-Intervention.jpeg'
  },
  {
    title: 'Evaluación de Comportamiento',
    description: 'Análisis profundo de los disparadores de comportamiento para crear estrategias efectivas.',
    image: '/images/wp/Behavior-Assessment.jpeg'
  },
  {
    title: 'Evaluación de Habilidades',
    description: 'Seguimiento del progreso usando herramientas ABLLS, AFLS y VB-MAPP.',
    image: '/images/wp/Skills-Assessment.jpeg'
  },
  {
    title: 'Capacitación para Padres',
    description: 'Enseñamos a las familias técnicas de ABA para apoyar el progreso en casa.',
    image: '/images/wp/Family-Centered.jpeg'
  },
  {
    title: 'Evaluaciones Remotas',
    description: 'Evaluaciones flexibles que brindan atención experta desde cualquier ubicación.',
    image: '/images/wp/Remote-Assessments.jpeg'
  }
] : [
  {
    title: 'In-Home 1:1 ABA Therapy',
    description: 'Customized one-on-one sessions that improve communication, social skills, and daily living abilities.',
    image: '/images/wp/AdobeStock_569313061.jpeg'
  },
  {
    title: 'Early Intervention Services',
    description: 'Intensive therapy for young children that builds crucial developmental foundations.',
    image: '/images/wp/Behavior-Intervention.jpeg'
  },
  {
    title: 'Behavior Assessment',
    description: 'In-depth analysis of behavior triggers to create effective intervention strategies.',
    image: '/images/wp/Behavior-Assessment.jpeg'
  },
  {
    title: 'Skills Assessment',
    description: 'Track progress using ABLLS, AFLS, and VB-MAPP tools to measure growth.',
    image: '/images/wp/Skills-Assessment.jpeg'
  },
  {
    title: 'Parent Training',
    description: 'We teach families ABA techniques to support progress at home.',
    image: '/images/wp/Family-Centered.jpeg'
  },
  {
    title: 'Remote Assessments',
    description: 'Flexible assessments providing expert care from any location.',
    image: '/images/wp/Remote-Assessments.jpeg'
  }
];

// FAQs
const defaultFaqs = lang === 'es' ? [
  {
    question: '¿Cómo es una sesión típica de terapia ABA?',
    answer: `Las sesiones combinan enseñanza estructurada con aprendizaje en entorno natural. Típicamente duran de 2-6 horas e incluyen actividades basadas en el juego, práctica de rutinas diarias y ejercicios de comunicación. Nuestros terapeutas trabajan individualmente con su hijo en ${cityName}.`
  },
  {
    question: '¿Qué seguros aceptan?',
    answer: `Aceptamos la mayoría de los seguros principales incluyendo Aetna, United Healthcare, Superior Healthplan, Cigna y Blue Cross Blue Shield. Verificamos beneficios y proporcionamos estimaciones de costos para las familias de ${cityName}.`
  },
  {
    question: '¿Cómo participan los padres en la terapia?',
    answer: 'Ofrecemos reuniones semanales del equipo, capacitación práctica en técnicas, actualizaciones regulares de logros y estrategias para apoyo entre sesiones.'
  },
  {
    question: '¿Qué progreso podemos esperar?',
    answer: 'Muchas familias reportan mejoras en comunicación dentro de los primeros meses, junto con progreso en habilidades de vida diaria y reducción de comportamientos desafiantes.'
  },
  {
    question: '¿Por qué elegir terapia ABA a domicilio?',
    answer: `La terapia a domicilio en ${cityName} permite que su hijo aprenda en su entorno natural, reduciendo el estrés y promoviendo mejor generalización de habilidades.`
  }
] : [
  {
    question: 'What does a typical ABA therapy session look like?',
    answer: `Sessions combine structured teaching with natural environment learning. They typically last 2-6 hours and include play-based activities, daily routine practice, and communication exercises. Our therapists work one-on-one with your child in ${cityName}.`
  },
  {
    question: 'What insurance do you accept?',
    answer: `We accept most major insurance including Aetna, United Healthcare, Superior Healthplan, Cigna, and Blue Cross Blue Shield. We verify benefits and provide cost estimates for ${cityName} families.`
  },
  {
    question: 'How are parents involved in the therapy?',
    answer: 'We offer weekly team meetings, hands-on technique training, regular achievement updates, and strategies for between-session support.'
  },
  {
    question: 'What progress can we expect?',
    answer: 'Many families report improvements in communication within the first few months, along with progress in daily living abilities and reduction in behavioral challenges.'
  },
  {
    question: 'Why choose in-home ABA therapy?',
    answer: `In-home therapy in ${cityName} allows your child to learn in their natural environment, reducing stress and promoting better skill generalization.`
  }
];

const services = location.locationFields?.services?.length > 0
  ? location.locationFields.services
  : defaultServices;

const faqs = location.locationFields?.faqs?.length > 0
  ? location.locationFields.faqs
  : defaultFaqs;

// Generate schemas
const localBusinessSchema = generateLocalBusinessSchema(location, canonicalUrl);
const faqSchema = generateFAQSchema(faqs);
const schemas = [localBusinessSchema, faqSchema];
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonicalUrl}
  ogImage={ogImage}
  schema={schemas}
>
  <!-- Hero Section - Clean, like WordPress -->
  <section class="relative min-h-[450px] lg:min-h-[500px] text-white overflow-hidden">
    <div class="absolute inset-0">
      <img
        src="/images/wp/ProsperaHealthcare.jpg"
        alt={`ABA Therapy in ${cityName}, Texas`}
        class="w-full h-full object-cover"
      />
      <div class="absolute inset-0 bg-gradient-to-r from-primary-900/90 via-primary-800/80 to-primary-700/60"></div>
    </div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-20 flex items-center min-h-[450px] lg:min-h-[500px]">
      <div class="max-w-2xl">
        <div class="mb-6">
          <Breadcrumbs items={breadcrumbs} />
        </div>

        <h1 class="text-5xl font-bold leading-tight mb-6 drop-shadow-lg text-white">
          {lang === 'es' ? `Terapia ABA en ${cityName}` : `ABA Therapy in ${cityName}`}
        </h1>

        <p class="text-lg text-white/90 max-w-xl mb-8 drop-shadow">
          {lang === 'es'
            ? `Terapia ABA personalizada a domicilio para apoyar el crecimiento y desarrollo de su hijo en ${cityName}.`
            : `Personalized in-home ABA therapy to support your child's growth and development in ${cityName}.`}
        </p>

        <div class="flex flex-wrap gap-4">
          <Button href={lang === 'es' ? '/es/contacto/' : '/contact/'} size="lg">
            {lang === 'es' ? 'Programar Consulta' : 'Schedule Consultation'}
          </Button>
          <a
            href="tel:9729002488"
            class="inline-flex items-center justify-center px-6 py-3 text-lg font-semibold text-white border-2 border-white rounded-lg hover:bg-white hover:text-primary-600 transition-colors"
          >
            <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            (972) 900-2488
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Insurance Partners -->
  <InsuranceLogos lang={lang} />

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-16">

    <!-- Intro Section -->
    <section class="mb-16">
      <div class="max-w-3xl">
        <h2 class="text-2xl font-bold text-neutral-900 mb-6">
          {lang === 'es' ? 'Su Socio en el Viaje de Su Hijo' : 'Your Partner in Your Child\'s Journey'}
        </h2>
        <div class="prose prose-lg text-neutral-600">
          <p>
            {lang === 'es'
              ? `Prospera Healthcare ofrece terapia ABA clínicamente comprobada directamente en su hogar en ${cityName}. Nuestro equipo incluye Analistas de Comportamiento Certificados (BCBAs) que diseñan y supervisan todos los programas, y Técnicos de Comportamiento Registrados (RBTs) que proporcionan terapia directa.`
              : `Prospera Healthcare offers clinically-proven ABA therapy directly to your home in ${cityName}. Our team includes Board Certified Behavior Analysts (BCBAs) who design and supervise all programs, and Registered Behavior Technicians (RBTs) providing direct therapy.`}
          </p>
          <p>
            {lang === 'es'
              ? 'La investigación indica que los niños progresan más con 20-40 horas de terapia por semana. Trabajamos con su familia para determinar la intensidad óptima para las necesidades únicas de su hijo.'
              : 'Research indicates children make the most progress with 20-40 hours of therapy per week. We work with your family to determine the optimal intensity for your child\'s unique needs.'}
          </p>
        </div>
      </div>
    </section>

    <!-- Services Section -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold text-neutral-900 mb-8">
        {lang === 'es' ? `Servicios de Terapia ABA en ${cityName}` : `ABA Therapy Services in ${cityName}`}
      </h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {services.map((service) => (
          <div class="bg-white border border-neutral-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow">
            {service.image && (
              <div class="h-40 overflow-hidden">
                <img
                  src={service.image}
                  alt={service.title}
                  class="w-full h-full object-cover"
                  loading="lazy"
                />
              </div>
            )}
            <div class="p-6">
              <h3 class="text-lg font-semibold text-neutral-900 mb-2">
                {service.title}
              </h3>
              <p class="text-neutral-600">{service.description}</p>
            </div>
          </div>
        ))}
      </div>
    </section>

    <!-- How It Works Section -->
    <section class="mb-16 bg-neutral-50 rounded-2xl p-8 lg:p-12">
      <h2 class="text-2xl font-bold text-neutral-900 mb-8 text-center">
        {lang === 'es' ? 'Cómo Funciona' : 'How It Works'}
      </h2>
      <div class="grid md:grid-cols-3 gap-8">
        <div class="text-center">
          <div class="w-16 h-16 mx-auto mb-4 bg-primary-500 rounded-full flex items-center justify-center">
            <span class="text-2xl font-bold text-white">1</span>
          </div>
          <h3 class="text-lg font-semibold text-neutral-900 mb-2">
            {lang === 'es' ? 'Consulta Gratuita' : 'Free Consultation'}
          </h3>
          <p class="text-neutral-600">
            {lang === 'es'
              ? 'Contáctenos para discutir las necesidades de su hijo y conocer cómo podemos ayudar.'
              : 'Contact us to discuss your child\'s needs and learn how we can help.'}
          </p>
        </div>
        <div class="text-center">
          <div class="w-16 h-16 mx-auto mb-4 bg-primary-500 rounded-full flex items-center justify-center">
            <span class="text-2xl font-bold text-white">2</span>
          </div>
          <h3 class="text-lg font-semibold text-neutral-900 mb-2">
            {lang === 'es' ? 'Evaluación Integral' : 'Comprehensive Assessment'}
          </h3>
          <p class="text-neutral-600">
            {lang === 'es'
              ? 'Nuestros BCBAs evalúan las fortalezas y necesidades únicas de su hijo.'
              : 'Our BCBAs assess your child\'s unique strengths and needs.'}
          </p>
        </div>
        <div class="text-center">
          <div class="w-16 h-16 mx-auto mb-4 bg-primary-500 rounded-full flex items-center justify-center">
            <span class="text-2xl font-bold text-white">3</span>
          </div>
          <h3 class="text-lg font-semibold text-neutral-900 mb-2">
            {lang === 'es' ? 'Plan Personalizado' : 'Personalized Plan'}
          </h3>
          <p class="text-neutral-600">
            {lang === 'es'
              ? 'Comenzamos la terapia ABA basada en evidencia adaptada a los objetivos de su hijo.'
              : 'We begin evidence-based ABA therapy tailored to your child\'s goals.'}
          </p>
        </div>
      </div>
    </section>

    <!-- FAQs Section -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold text-neutral-900 mb-8">
        {lang === 'es' ? `Preguntas Frecuentes` : `Frequently Asked Questions`}
      </h2>
      <FAQAccordion client:visible faqs={faqs} lang={lang} />
    </section>

    <!-- Nearby Locations -->
    {nearbyLocations.length > 0 && (
      <section class="mb-16">
        <h2 class="text-2xl font-bold text-neutral-900 mb-8">
          {lang === 'es' ? 'También Servimos Áreas Cercanas' : 'We Also Serve Nearby Areas'}
        </h2>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          {nearbyLocations.map((nearby) => {
            const nearbyCity = nearby.locationFields?.cityName ||
              nearby.slug.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
            const nearbyHref = lang === 'es'
              ? `/es/terapia-aba/texas/${nearby.slug}/`
              : `/aba-therapy/texas/${nearby.slug}/`;

            return (
              <a
                href={nearbyHref}
                class="px-4 py-3 bg-neutral-50 rounded-lg text-neutral-700 hover:bg-primary-50 hover:text-primary-700 transition-colors no-underline text-center font-medium"
              >
                {nearbyCity}
              </a>
            );
          })}
        </div>
      </section>
    )}

    <!-- CTA Section -->
    <section class="bg-primary-600 rounded-2xl p-8 lg:p-12 text-center text-white">
      <h2 class="text-2xl font-bold mb-4 text-white">
        {lang === 'es' ? `Comience la Terapia ABA en ${cityName} Hoy` : `Start ABA Therapy in ${cityName} Today`}
      </h2>
      <p class="text-lg text-primary-100 max-w-2xl mx-auto mb-8">
        {lang === 'es'
          ? 'Contáctenos hoy para programar una consulta gratuita y conocer cómo podemos ayudar a su familia.'
          : 'Contact us today to schedule a free consultation and learn how we can help your family.'}
      </p>
      <div class="flex flex-wrap justify-center gap-4">
        <Button href={lang === 'es' ? '/es/contacto/' : '/contact/'} variant="secondary" size="lg" class="!text-white !border-white hover:!bg-white hover:!text-primary-600">
          {lang === 'es' ? 'Programar Consulta' : 'Schedule Consultation'}
        </Button>
        <a
          href="tel:9729002488"
          class="inline-flex items-center justify-center px-6 py-3 text-lg font-semibold text-white hover:text-primary-100 transition-colors no-underline"
        >
          <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
          </svg>
          (972) 900-2488
        </a>
      </div>
    </section>
  </div>
</BaseLayout>
