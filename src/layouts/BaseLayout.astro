---
/**
 * Base Layout
 * The foundation for all pages - includes HTML structure, global styles, and scripts
 */

import '@/styles/global.css';
import SEOHead from '@/components/common/SEOHead.astro';
import Header from '@/components/common/Header.astro';
import Footer from '@/components/common/Footer.astro';
import { getLangFromUrl, t } from '@/i18n/ui';

interface AlternateLanguage {
  hreflang: string;
  href: string;
}

interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  publishedTime?: string;
  modifiedTime?: string;
  author?: string;
  noindex?: boolean;
  alternateLanguages?: AlternateLanguage[];
  schema?: object | object[];
  class?: string;
}

const {
  title,
  description,
  canonical,
  ogImage,
  ogType,
  publishedTime,
  modifiedTime,
  author,
  noindex,
  alternateLanguages,
  schema,
  class: className,
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const skipToContent = t(lang, 'a11y.skipToContent');
---

<!DOCTYPE html>
<html lang={lang === 'es' ? 'es-MX' : 'en-US'} class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/brand/favicon.png" />
    <link rel="apple-touch-icon" href="/images/brand/apple-touch-icon.png" />

    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Inter font: Regular (400) and Bold (700) only per Practical UI -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <SEOHead
      title={title}
      description={description}
      canonical={canonical}
      ogImage={ogImage}
      ogType={ogType}
      publishedTime={publishedTime}
      modifiedTime={modifiedTime}
      author={author}
      noindex={noindex}
      alternateLanguages={alternateLanguages}
      schema={schema}
    />

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#3AA5AD" />
  </head>

  <body class="min-h-screen flex flex-col bg-white text-neutral-800 antialiased">
    <!-- Skip to content link for accessibility -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary-500 focus:text-white focus:rounded-md"
    >
      {skipToContent}
    </a>

    <Header />

    <main id="main-content" class:list={['flex-1', className]}>
      <slot />
    </main>

    <Footer />

    <!-- Animation Observer Script -->
    <script>
      // Intersection Observer for entrance animations
      const observerOptions = {
        root: null,
        rootMargin: '0px 0px -50px 0px',
        threshold: 0.1,
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      // Observe all elements with data-animate attribute
      document.querySelectorAll('[data-animate]').forEach((el) => {
        observer.observe(el);
      });
    </script>
  </body>
</html>
